# –ü–∞—Ä—Å–µ—Ä

–ü–∞—Ä—Å–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å html –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤ `php` –∫–ª–∞—Å—Å `DOMXPath`. –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–¥–∞–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ `.xml`.  

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–æ–≥–æ `xml` –ø–æ—Ö–æ–∂–∞ –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É `yml`:

```xml
<?xml version="1.0" encoding="utf-8"?>
<catalog>
    <categories>
        <category id="d855ddef997f7d7a8dec872ad7ef9e37" parentId="d71c83e2d7915a882bcf3350d08d7ac7">–†–∞–∑–¥–µ–ª 1</category>
        <category id="2e0ca46f8297c2083e72f1ee7cbddafc" parentId="d71c83e2d7915a882bcf3350d08d7ac7">–†–∞–∑–¥–µ–ª 2</category>
    <categories/>
    <offers>
        <offer>
            <name> IP-–≤–∏–¥–µ–æ–¥–æ–º–æ—Ñ–æ–Ω BAS-IP AT-07L SILVER</name>
            <category>–í–∏–¥–µ–æ–¥–æ–º–æ—Ñ–æ–Ω—ã/IP –≤–∏–¥–µ–æ–¥–æ–º–æ—Ñ–æ–Ω—ã</category>
            <categoryId>3118e2253560273158bd4ded1eed3d3c</categoryId>
            <code>001373</code>
            <price>32 762¬†</price>
            <brand>BAS-IP</brand>
            <images>
                <image>
                    https://cdn.shortpixel.ai/client/q_lqip,ret_wait/https://pipl24.ru/wp-content/uploads/2020/10/at-07l...jpg
                </image>
            </images>
            <props>
                <prop id="ae962fb2001486c74f8c5d599fcfc172">
                    <name>–î–∏—Å–ø–ª–µ–π</name>
                    <value>7‚Äù TFT LCD, —Å–µ–Ω—Å–æ—Ä–Ω—ã–π –µ–º–∫–æ—Å—Ç–Ω—ã–π</value>
                </prop>
                <prop id="e99bf403082ecda1aab68c963c9cea07">
                    <name>–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞</name>
                    <value>1024√ó600</value>
                </prop>
            </props>
        </offer>
    </offers>
</catalog>
```
–û—Ç–ª–∏—á–∏–µ –æ—Ç `yml` - –≤ –ø–æ–¥—Ö–æ–¥–µ –∫ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—é –∞—Ç—Ä–∏–±—É—Ç–æ–≤ `id`. –ó–¥–µ—Å—å –∞—Ç—Ä–∏–±—É—Ç—ã `id` —Ç–æ–≤–∞—Ä–æ–≤/—Ä–∞–∑–¥–µ–ª–æ–≤/—Å–≤–æ–π—Å—Ç–≤ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –ø—É—Ç–µ–º `md5`-–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞/—Ä–∞–∑–¥–µ–ª–∞/—Å–≤–æ–π—Å—Ç–≤–∞. –í `yml` –≤ –∫–∞—á–µ—Å—Ç–≤–µ `id` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.
## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫

- `classes` - –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã –ø–∞—Ä—Å–µ—Ä–∞
- `utils` - –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –Ω–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –≤ –∫–ª–∞—Å—Å—ã
- `parsers` - –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å **—Ä–∞–±–æ—á–∏–º–∏** –ø–∞—Ä—Å–µ—Ä–∞–º–∏
- `dev` - –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –ø—Ä–æ—á–µ–≥–æ –∫–æ–¥–∞
- `test` - —Ç–µ—Å—Ç—ã ...ü§•

## API
–ü–∞—Ä—Å–µ—Ä –º–æ–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å, –∏—Å–ø–æ–ª—å–∑—É—è 3 –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–ª–∞—Å—Å–∞ - `SectionParser`, `Offer` –∏ `XMLGenerator`.  
### –ü–∞—Ä—Å–µ—Ä —Ä–∞–∑–¥–µ–ª–æ–≤
`SectionParser` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

- string `$url` - url —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å —Ä–∞–∑–¥–µ–ª–∞–º–∏
- array `$params` - –º–∞—Å—Å–∏–≤ —Å xpath-–ø—É—Ç—è–º–∏ (—Å–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –¥–∞–ª–µ–µ)
- string `$parent_code` - –∫–æ–¥ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞.

–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ `xpath` –¥–ª—è —Ä–∞–∑–¥–µ–ª–æ–≤:

- `section` - –±–ª–æ–∫ —Ä–∞–∑–¥–µ–ª–∞
- `link` - —Å—Å—ã–ª–∫–∞ (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—É—Ç–∏ `section`)
- `name` - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—É—Ç–∏ `section`) 

–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:
- `elements` - —Å—Å—ã–ª–∫–∞ –Ω–∞ –¥–µ—Ç–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç–æ—á–∫—É —ç–ª–µ–º–µ–Ω—Ç–∞ —Ä–∞–∑–¥–µ–ª–∞


–ú–µ—Ç–æ–¥ `get_section_list()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω—ã–π –º–∞—Å—Å–∏–≤ —Ä–∞–∑–¥–µ–ª–æ–≤.  
–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã :

- `node` - –æ–±—ä–µ–∫—Ç `DOMNode` –¥–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞; –æ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∫–∞–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è `xpath`-–∑–∞–ø—Ä–æ—Å–∞ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–∞. 
–í —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –¥–ª—è –ø–æ–¥—Ä–∞–∑–¥–µ–ª–∞ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –≤ `get_section_list()` –ø–∞—Ä–∞–º–µ—Ç—Ä `$parent_section`
- `name` - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞,
- `code` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π id —Ä–∞–∑–¥–µ–ª–∞, md5-—Ö—ç—à –Ω–∞–∑–≤–∞–Ω–∏—è
- `link` - —Å—Å—ã–ª–∫–∞ —Å —Ä–∞–∑–¥–µ–ª–∞,
- `parent_code` - md5-—Ö—ç—à —Ä–∞–∑–¥–µ–ª–∞  

–ú–µ—Ç–æ–¥ `get_elements_list()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ —Å—Å—ã–ª–æ–∫ –Ω–∞ –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –µ—Å–ª–∏ —Ç–∞–∫–∏–µ –±—ã–ª–∏ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ.  
–£ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ `SectionParser` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `$xpath['elements']` –∏–ª–∏ –≤ –º–µ—Ç–æ–¥ `get_elements_list()` –ø–µ—Ä–µ–¥–∞–Ω –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π `xpath`.

–ö–æ–º–±–∏–Ω–∏—Ä—É—è –º–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Å–∞ `SectionParser`, –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å flat-—Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ä–∞–∑–¥–µ–ª–æ–≤, –≥–¥–µ —É –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ –∑–∞–¥–∞–Ω—ã 

- –∏–º—è, 
- —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥, 
- —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞, 
- —Å—Å—ã–ª–∫–∞,
- —Å–ø–∏—Å–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤.
 

### –ü–∞—Ä—Å–µ—Ä –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
`Offer` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ —Å–ª–µ–¥—É—é—â–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

- string `$url` - url –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- array `$params` - –º–∞—Å—Å–∏–≤ —Å xpath-–ø—É—Ç—è–º–∏ (—Å–º. –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å)

–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä - `$category_code`.  
–û–Ω –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è, –µ—Å–ª–∏ —Å –µ–≥–æ –ø–æ–º–æ—â—å—é –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≤—è–∑–∫—É –∫ —Ä–∞–∑–¥–µ–ª—É. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ—Ç–æ–¥ `set_section_path()`, —á—Ç–æ–±—ã –∏–∑ —Ö–ª–µ–±–Ω—ã—Ö –∫—Ä–æ—à–µ–∫ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–ø–∞—Ä—Å–∏—Ç—å –ø—É—Ç—å –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏–π —Ä–∞–∑–¥–µ–ª–æ–≤.

–ü–µ—Ä–µ–¥–∞–π—Ç–µ –≤ `$xpath_params` –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å –Ω—É–∂–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏, —á—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å —Ç–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: 

- `name` - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
- `price` - —Ü–µ–Ω—É
- `images` - –∫–∞—Ä—Ç–∏–Ω–∫–∏
- `desc`, `preview` - —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤ html-—Ñ–æ—Ä–º–∞—Ç–µ
- `article` - –∞—Ä—Ç–∏–∫—É–ª
- `brand` - –±—Ä–µ–Ω–¥
- `props` - —Å–≤–æ–π—Å—Ç–≤–∞
- `section_path` - –ø—É—Ç—å –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏–π —Ä–∞–∑–¥–µ–ª–æ–≤ .`xpath` –∫ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º —Å—Å—ã–ª–∫–∞–º –≤ —Ö–ª–µ–±–Ω—ã—Ö –∫—Ä–æ—à–∫–∞—Ö. –ù–∞ –≤—ã—Ö–æ–¥–µ –±—É–¥–µ—Ç —Å—Ç—Ä–æ–∫–∞ —Ç–∏–ø–∞ `–†–∞–∑–¥–µ–ª/–ü–æ–¥—Ä–∞–∑–¥–µ–ª`.

–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–∞—Ä—Å–∏—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ `Offer`:
```php
$offer = new Offer($elemUrl, $detail_params);
```
–∏ –≤ `$offer` –±—É–¥–µ—Ç –æ–±—ä–µ–∫—Ç —Å–æ –≤—Å–µ–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏.

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è XML
–ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ `XMLGenerator` —Å–æ–∑–¥–∞–µ—Ç –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–æ–∫—É–º–µ–Ω—Ç–∞:
```xml
<?xml version="1.0" encoding="utf-8"?>
<catalog>
  <categories/>
  <offers/>
</catalog>
```
–£ –∫–ª–∞—Å—Å–∞ `XMLGenerator` –µ—Å—Ç—å 3 –º–µ—Ç–æ–¥–∞: 

- `add_category(array $section)` - –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ —Å–µ–∫—Ü–∏—é `categories` –∫–∞—Ç–µ–≥–æ—Ä–∏—é
- `add_offer(Offer $offer)` - –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ —Å–µ–∫—Ü–∏—é `offers` —ç–ª–µ–º–µ–Ω—Ç 
- `save_xml(string $filename)` - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `filename.xml` –≤ –ø–∞–ø–∫—É `/output/`. –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ–∞–π–ª –ø—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –∏–º–µ–Ω–∏. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.